var JPI=JPI||{};JPI.templating=new function(){return this.moustaches={},this.getMoustache=function(t){return this.moustaches[t]||(this.moustaches[t]=new RegExp("{{2} ?"+t+" ?}{2}","g")),this.moustaches[t]},{getMoustache:this.getMoustache.bind(this)}},JPI.Template=function(n,t){this.context=t||{},this.replace=function(t,e){var i=typeof e;if("string"==i||"number"==i){var s=JPI.templating.getMoustache(t);n=n.replace(s,e)}else if("object"==i)for(var o in e)!{}.hasOwnProperty.call(e,o)||(n=this.replace(t?t+"."+o:o,e[o]));return n},this.process=function(t){t&&this.replace(null,t)},this.get=function(){return this.process(t),n},this.renderIn=function(t){t.append(this.get())}},JPI.ajax=new function(){return this.checkAndRenderError=function(t,e,i){i=i||"";t&&(t.error?i=t.error:t.message&&(i=t.message)),i&&e(i)},this.renderRowsOrError=function(t,e,i,s){if(t&&t.data&&t.data.length){for(var o=0;o<t.data.length;o++)!{}.hasOwnProperty.call(t.data,o)||e(t.data[o]);return!0}return this.checkAndRenderError(t,i,s),!1},this.request=function(t){return jQuery.ajax({url:t.url,method:t.method.toUpperCase(),data:t.data,dataType:"json",success:t.onSuccess,error:function(){t.onError("Error Loading Content.")}})},{renderRowsOrError:this.renderRowsOrError.bind(this),request:this.request.bind(this)}},JPI.modal=function(e){return this.$body=jQuery("body"),this.$page=jQuery(".page-container"),this.lastFocused=null,this.$focusables=null,this.$firstFocusable=null,this.$lastFocusable=null,this.close=function(){e.hasClass("is-open")&&(this.$body.removeClass("no-scroll"),this.$page.attr("aria-hidden","false"),e.removeClass("is-open"),e.attr({tabindex:-1,"aria-hidden":!0,hidden:"hidden"}),this.lastFocused&&this.lastFocused.focus(),e.trigger("closed"))},this.triggerClose=function(){var t=e.find(".js-modal-close");t.length?t.trigger("click"):this.close()},this.onModalClick=function(t){t=jQuery(t.target);t.children(".modal__content").length&&!t.closest(".modal__content").length&&this.triggerClose()},this.onBackwardTab=function(t){document.activeElement===this.$firstFocusable[0]&&(t.preventDefault(),this.$lastFocusable.focus())},this.onForwardTab=function(t){document.activeElement===this.$lastFocusable[0]&&(t.preventDefault(),this.$firstFocusable.focus())},this.onKeyDown=function(t){switch(t.keyCode||t.key){case 9:case"Tab":this.$focusables.length<=1?t.preventDefault():t.shiftKey?this.onBackwardTab(t):this.onForwardTab(t);break;case 27:case"Escape":this.triggerClose()}},this.open=function(){this.lastFocused=document.activeElement,this.$body.addClass("no-scroll"),this.$page.attr("aria-hidden","true"),e.attr({tabindex:0,"aria-hidden":!1,hidden:!1}),e.addClass("is-open"),this.$focusables=JPI.getFocusableChildren(e);var t=this.$focusables.length;(t?(this.$firstFocusable=jQuery(this.$focusables[0]),this.$lastFocusable=jQuery(this.$focusables[t-1]),this.$firstFocusable):e).focus(),e.trigger("opened"),e.on("click",this.onModalClick.bind(this)),e.on("click",".js-modal-close",this.close.bind(this)),e.on("keydown",this.onKeyDown.bind(this))},{open:this.open.bind(this),close:this.close.bind(this)}},JPI.SlideShow=function(t){var l=this;return this.getXPosition=function(t){return(t.changedTouches?t.changedTouches[0]:t).clientX},this.removeSelector=function(t){return t.substring(1)},this.options=jQuery.extend({selector:".slide-show",viewportSelector:".slide-show__viewport",slidesContainerSelector:".slide-show__slides",slideSelector:".slide-show__slide",bulletsSelector:".slide-show__bullets",bulletSelector:".slide-show__bullet",navSelector:".slide-show__nav",slidesPerView:1,durationPerSlide:5e3,autoplay:!0,loop:!0},t||{}),this.options.activeSlideClass=this.removeSelector(this.options.slideSelector)+"--active",this.options.bulletSelector&&(this.options.activeBulletClass=this.removeSelector(this.options.bulletSelector)+"--active"),this.$slideShow,this.$viewport,this.$container,this.$slides,this.$bulletsContainer,this.$bullets,this.$navs,this.interval,this.getConfig=function(t){return(window.innerWidth>=JPI.getInt(JPI.breakpoints.desktop)&&this.options.breakpoints&&this.options.breakpoints.desktop&&this.options.breakpoints.desktop[t]?this.options.breakpoints.desktop:window.innerWidth>=JPI.getInt(JPI.breakpoints.tablet)&&this.options.breakpoints&&this.options.breakpoints.tablet&&this.options.breakpoints.tablet[t]?this.options.breakpoints.tablet:this.options)[t]},this.resetTransition=function(){this.$container.css("transition-duration","")},this.widenSlideShow=function(){var t=this.$viewport.innerWidth(),e=this.$slides.length,i=t*e,s=this.getConfig("slidesPerView");1<s&&(t/=s,s=s%2==0?(i=t*e+t/2,t/2):(i=t*e+t,t),this.$slides.first().css("margin-left",s)),this.$slides.css("width",t+"px"),this.$container.css("width",i+"px")},this.getPosition=function(t){var e=0,i=this.getConfig("slidesPerView");return 1<i&&!t.is(":first-child")&&(e=t.innerWidth(),i%2==0)&&(e/=2),"-"+(t.position().left-e)+"px"},this.resetToCurrentSlide=function(){var t=this.$slideShow.find("."+this.options.activeSlideClass);this.$container.css({transitionDuration:"0s",left:this.getPosition(t)}),this.resetTransition()},this.repositionSlides=function(){this.widenSlideShow(),this.resetToCurrentSlide()},this.setupNav=function(){var t;this.$navs&&!this.options.loop&&(t=this.$slideShow.find("."+this.options.activeSlideClass),this.$navs.filter("[data-direction='previous']").attr("disabled",t.is(":first-child")),this.$navs.filter("[data-direction='next']").attr("disabled",t.is(":last-child")))},this.moveToSlide=function(t){var e,i=this.$slideShow.find("."+this.options.activeSlideClass);i.removeClass(this.options.activeSlideClass),this.$bullets&&this.$bullets.filter("."+this.options.activeBulletClass).removeClass(this.options.activeBulletClass),t.addClass(this.options.activeSlideClass),this.$container.css("left",this.getPosition(t)),this.$bullets&&(e=t.attr("id"),this.$bullets.filter("[data-slide-id='#"+e+"']").addClass(this.options.activeBulletClass)),this.setupNav(),JPI.getFocusableChildren(i).attr("tabindex",-1),JPI.getFocusableChildren(t).attr("tabindex","")},this.move=function(t){var e,i=this.$slideShow.find("."+this.options.activeSlideClass);"previous"===t?!(e=i.prev()).length&&this.options.loop&&(e=this.$slides.last()):!(e=i.next()).length&&this.options.loop&&(e=this.$slides.first()),e.length?this.moveToSlide(e):this.resetToCurrentSlide()},this.onSlideDrag=function(t){var e=this.$container[0],i=this.$container.position().left,s=this.getXPosition(t),o=function(){e.removeEventListener("touchmove",a),e.removeEventListener("mousemove",a),e.removeEventListener("touchend",r),e.removeEventListener("mouseup",r),e.removeEventListener("mouseleave",r)},n=function(){l.resetToCurrentSlide(),l.options.autoplay&&l.resume(),o()},a=function(t){t=l.getXPosition(t);l.$container.css({transitionDuration:"0s",left:i-(s-t)+"px"})},r=function(t){t=l.getXPosition(t),t=s-t;(15<=Math.abs(t)?(l.resetTransition(),l.move(t<0?"previous":"next"),l.options.autoplay&&l.resume(),o):n)()};this.pause(),e.addEventListener("touchmove",a),e.addEventListener("mousemove",a),e.addEventListener("touchend",r),e.addEventListener("mouseup",r),e.addEventListener("mouseleave",r)},this.pause=function(){clearInterval(this.interval)},this.stop=function(){var t=this.$container[0];t.removeEventListener("mousedown",this.onSlideDrag),t.removeEventListener("touchstart",this.onSlideDrag),clearInterval(this.interval)},this.resume=function(){this.interval=setInterval(function(){l.move("next")},this.options.durationPerSlide)},this.changeToSlide=function(t){t=jQuery(t.target).attr("data-slide-id"),t=this.$slideShow.find(t);this.pause(),this.moveToSlide(t),this.options.autoplay&&this.resume()},this.navigate=function(t){this.pause(),this.move(jQuery(t.target).attr("data-direction")),this.options.autoplay&&this.resume()},this.start=function(){this.$bullets&&this.$bullets.off("click",this.changeToSlide),this.$navs&&this.$navs.off("click",this.navigate),this.$slideShow=jQuery(this.options.selector),this.$viewport=this.$slideShow.find(this.options.viewportSelector),this.$container=this.$slideShow.find(this.options.slidesContainerSelector),this.$slides=this.$slideShow.find(this.options.slideSelector),this.options.bulletsSelector&&this.options.bulletSelector&&(this.$bulletsContainer=this.$slideShow.find(this.options.bulletsSelector),this.$bullets=this.$slideShow.find(this.options.bulletSelector),this.$bullets.on("click",this.changeToSlide.bind(this))),this.$navs=this.$slideShow.find(this.options.navSelector),this.$navs&&this.$navs.on("click",this.navigate.bind(this)),jQuery(window).on("orientationchange resize",JPI.debounce(this.repositionSlides.bind(this),150));var t,e,i=this.$slides.length;i<=0?(this.$bulletsContainer&&this.$bulletsContainer.hide(),this.$navs&&this.$navs.hide()):(t=this.$slides.first(),e=this.$slides.not(t),JPI.getFocusableChildren(e).attr("tabindex",-1),t.addClass(this.options.activeSlideClass),this.$bullets&&this.$bullets.first().addClass(this.options.activeBulletClass),1<i&&(this.widenSlideShow(),this.$bulletsContainer&&this.$bulletsContainer.show(),this.$navs&&(this.$navs.show(),this.setupNav()),this.$container[0].addEventListener("mousedown",this.onSlideDrag.bind(this)),this.$container[0].addEventListener("touchstart",this.onSlideDrag.bind(this)),this.options.autoplay)&&this.resume())},{start:this.start.bind(this),pause:this.pause.bind(this),resume:this.resume.bind(this),stop:this.stop.bind(this)}},JPI.ExpandedSlideShow=function(){return this.$element=jQuery(".expanded-slide-show"),this.$currentCount=jQuery(".expanded-slide-show__current-count"),this.$nav=jQuery(".expanded-slide-show__nav"),this.timeout,this.$slides={},this.current=0,this.modal,this.displaySlide=function(t){t.attr("src",this.$slides[this.current].src),this.$currentCount.text(this.current+1),jQuery(".expanded-slide-show__bullet:eq("+this.current+")").addClass("expanded-slide-show__bullet--active")},this.changeSlide=function(t){var e;t>=this.$slides.length?t=0:t<0&&(t=this.$slides.length-1),t!==this.current&&(this.current=t,t=jQuery(".expanded-slide-show__image--active"),e=jQuery(".expanded-slide-show__image").not(t),jQuery(".expanded-slide-show__bullet--active").removeClass("expanded-slide-show__bullet--active"),this.displaySlide(e),e.addClass("expanded-slide-show__image--active"),t.removeClass("expanded-slide-show__image--active"))},this.next=function(){this.changeSlide(this.current+1)},this.previous=function(){this.changeSlide(this.current-1)},this.onNavClick=function(t){this[jQuery(t.target).attr("data-direction")]()},this.onBulletClick=function(t){t=jQuery(t.target).attr("data-slide-id"),t=JPI.getInt(t);this.changeSlide(t)},this.onClose=function(){this.$element.removeClass("expanded-slide-show--closing"),this.modal.close(),this.timeout=null},this.close=function(){this.$element.removeClass("expanded-slide-show--open").addClass("expanded-slide-show--closing"),this.timeout=setTimeout(this.onClose.bind(this),990),jQuery(".expanded-slide-show__close").off("click",this.close)},this.onCloseClick=function(t){t.stopPropagation(),this.close()},this.open=function(t,e){clearTimeout(this.timeout),this.$slides=jQuery(t).parents(e).find(".js-expandable-image");var i=this.$slides.length,s=(jQuery(".expanded-slide-show__total-count").text(i),jQuery(".expanded-slide-show__bullets"));if(s.text(""),1<i){for(var o=0;o<i;o++)this.$slides[o]===t&&(this.current=o),JPI.renderNewElement("button",s,{class:"expanded-slide-show__bullet","data-slide-id":o});this.$nav.show()}else this.$nav.hide();this.displaySlide(jQuery(".expanded-slide-show__image--active")),this.modal=new JPI.modal(this.$element),this.modal.open(),this.$element.addClass("expanded-slide-show--open"),this.$nav.on("click",this.onNavClick.bind(this)),jQuery(".expanded-slide-show__bullet").on("click",this.onBulletClick.bind(this)),jQuery(".expanded-slide-show__close").on("click",this.onCloseClick.bind(this))},{open:this.open.bind(this),next:this.next.bind(this),previous:this.previous.bind(this),close:this.close.bind(this)}},JPI.api=(()=>{var i=new Intl.DateTimeFormat("default",{month:"long",year:"numeric"});return{formatProjectData:function(t){var e;return t.date&&(e=new Date(t.date),t.date=i.format(e)),t}}})(),new function(){var i=this;this.url=new URL(window.location),this.$body=jQuery("body"),this.$projectType=jQuery(".js-project-type"),this.$loading=jQuery(".projects__loading"),this.$paginationStatus=jQuery(".projects__pagination-status"),this.$error=jQuery(".projects__error"),this.$projects=jQuery(".projects__items"),this.$pagination=jQuery(".projects__pagination"),this.modalSelector=".detailed-project",this.$modal=jQuery(this.modalSelector),this.modal=new JPI.modal(this.$modal),this.$modalSlidesContainer=this.$modal.find(".slide-show__slides"),this.modalSlideShow=new JPI.SlideShow({selector:"#detailed-project-slide-show"}),this.page=JPI.getInt(jQuery(".js-page").val(),1),this.projectTemplate=jQuery("#project-template").text(),this.slideTemplate=jQuery("#slide-template").text(),this.bulletTemplate=jQuery("#slide-bullet-template").text(),this.projects={},this.renderError=function(t){this.$error.text(t).show(),this.$pagination.text("").hide(),this.$projects.hide(),this.$loading.hide()},this.renderPaginationItem=function(t,e,i){var s=new URL(window.location),o=(1<t?s.searchParams.set("page",t):s.searchParams.delete("page"),["pagination__link"]),i=(i&&o.push("pagination__link--active"),JPI.createElement("a",{class:o.join(" "),text:t,href:s.toString()}));JPI.renderNewElement("li",e,{class:"pagination__item",html:i})},this.renderPagination=function(t){if(t>JPI.projects.perPage){for(var e=this.page,i=Math.ceil(t/JPI.projects.perPage),s=1;s<=i;s++)this.renderPaginationItem(s,this.$pagination,s===e);this.$pagination.css("display","inline-block")}},this.renderProjectTags=function(t,e){var i=jQuery(e).find(".project__tags");if(i.length)for(var s=t.tags,o=0;o<s.length;o++){var n=s[o].trim();""!==n&&JPI.renderNewElement("span",i,{text:n,class:"project__tag"})}},this.renderProjectLinks=function(t,e){var i,s=jQuery(e).find(".project__links");t.url||t.download_url||t.github_url?((i={target:"_blank",rel:"noopener",classes:["project__link"]}).class=i.classes.join(" "),delete i.classes,t.url&&(i.href=t.url,i.title="Link to "+t.name,i.html="<i class='fas fa-link fa-2x'></i>",JPI.renderNewElement("a",s,i)),t.download_url&&(i.href=t.download_url,i.title="Link to download "+t.name,i.html="<i class='fas fa-download fa-2x'></i>",JPI.renderNewElement("a",s,i)),t.github_url&&(i.href=t.github_url,i.title="Link to "+t.name+" code on GitHub",i.html="<i class='fab fa-github fa-2x'></i>",JPI.renderNewElement("a",s,i))):e!==this.modalSelector&&s.remove()},this.renderProjectImages=function(t,e){if(t.images&&t.images.length)for(var e=jQuery(e).find(".slide-show"),i=e.find(".slide-show__slides"),s=e.find(".slide-show__bullets"),o=t.images,n=0;n<o.length;n++)if({}.hasOwnProperty.call(o,n)){var a,r,l=new JPI.Template(this.slideTemplate),h=new JPI.Template(this.bulletTemplate),d=o[n];for(a in d)!{}.hasOwnProperty.call(d,a)||(r=d[a],l.replace(a,r),h.replace(a,r));l.renderIn(i),h.renderIn(s)}},this.renderProject=function(t){var e="#project-"+t.id;jQuery(e).length||(t=JPI.api.formatProjectData(t),this.projects[t.id]=t,new JPI.Template(this.projectTemplate,t).renderIn(this.$projects),this.renderProjectImages(t,e),this.renderProjectLinks(t,e))},this.gotProjects=function(t){this.$error.text("").hide(),this.$projects.text("").show(),this.$pagination.text("").hide(),this.$loading.hide(),JPI.ajax.renderRowsOrError(t,this.renderProject.bind(this),this.renderError.bind(this),"No Projects Found."),this.renderPagination(JPI.getInt(t._total_count));var e=this.$paginationStatus.attr("data-format");e=(e=(e=e.replace("{start}",(t._total_count?1:0)+(this.page-1)*JPI.projects.perPage)).replace("{end}",(this.page-1)*JPI.projects.perPage+t.data.length)).replace("{total}",t._total_count),this.$paginationStatus.html(e)},this.getProjects=function(){var t={filters:{},page:this.page,limit:JPI.projects.perPage};this.$projectType.val()&&(t.filters.type_id=this.$projectType.val()),JPI.ajax.request({method:"GET",url:JPI.projects.apiEndpoint+"/projects/",data:t,onSuccess:this.gotProjects.bind(this),onError:this.renderError.bind(this)})},this.openProjectModal=function(t){var t=jQuery(t.target).attr("data-project-id"),t=this.projects[t],e=this.$modal;e.find(".project__links, .project__tags, .slide-show__slides, .slide-show__bullets").text(""),e.find(".modal__heading").text(t.name),e.find(".project__date").text(t.date),e.find(".project__description").html(t.long_description),e.find(".project__type").text(t.type),this.renderProjectTags(t,this.modalSelector),this.renderProjectLinks(t,this.modalSelector),this.renderProjectImages(t,this.modalSelector),this.modal.open(),this.modalSlideShow.start()},this.onProjectModalClose=function(){this.modalSlideShow.stop(),this.$modalSlidesContainer.css({width:"",left:""})},this.storeLatestSearch=function(){1<this.page?this.url.searchParams.set("page",this.page):i.url.searchParams.delete("page");var t={page:this.page,type:this.$projectType.val()};history.pushState(t,window.title,this.url.toString()),"undefined"!=typeof ga&&(ga("set","page",url),ga("send","pageview"))},this.scrollToProjects=function(){JPI.scrollTo(this.$projects,20)},this.initListeners=function(){this.$projectType.on("change",function(t){i.page=1,jQuery(this).val()?i.url.searchParams.set("type",jQuery(this).find("option:selected").attr("data-urlname")):i.url.searchParams.delete("type"),i.storeLatestSearch(),i.getProjects()}),this.$projects.on("click",".project__read-more",this.openProjectModal.bind(this)),this.$modal.on("closed",this.onProjectModalClose.bind(this)),this.$pagination.on("click",".pagination__link",function(t){t.preventDefault(),t.stopPropagation();t=jQuery(t.target).text(),t=JPI.getInt(t,1);i.page!==t&&(i.page=t,i.scrollToProjects(),i.storeLatestSearch(),i.getProjects())}),window.addEventListener("popstate",function(t){var t=t.state||{},e=t.page||1,t=t.type||"";i.page=JPI.getInt(e,1),i.$projectType.val(t),i.scrollToProjects(),i.getProjects()})},this.init=function(){this.initListeners(),this.gotProjects(JPI.projects.apiResponse),this.$body.on("click",".js-expandable-image",function(t){(new JPI.ExpandedSlideShow).open(t.target,".js-expandable-image-group")})},jQuery(window).on("jpi-css-loaded",this.init.bind(this))};
//# sourceMappingURL=maps/portfolio.js.map
